!function(e){var t,n,r,i,s,o,u,a,f={getSliderValuesAtPositionPx:function(e,t){var n,r,i=this,s=i.data("pixel_to_value_mapping");if("undefined"!=typeof s)n=s(e),r=s(t);else{var o=f.getSliderWidthPx.call(i)-i.data("left_grip_width");n=f.inverse_rangemap_0_to_n.call(i,e,o),r=f.inverse_rangemap_0_to_n.call(i,t,o)}return[n,r]},validateAndMoveGripsToPx:function(e,t){var n=this,r=f.getSliderWidthPx.call(n)-n.data("left_grip_width");if(r>=t&&e>=0&&r>=e&&(!n.data("has_right_grip")||t>=e)){var i=n.data("cur_min"),s=n.data("cur_max");f.set_position_from_px.call(n,e,t),f.refresh_grips_style.call(n),f.notify_changed_implicit.call(n,"drag_move",i,s)}return n},updateAriaAttributes:function(){var e=this,t=e.data("settings"),n=e.find(t.left_grip_selector);if(e.data("has_right_grip")){var r=e.find(t.right_grip_selector);n.attr("aria-valuemin",e.data("range_min")).attr("aria-valuenow",l.get_current_min_value.call(e)).attr("aria-valuemax",l.get_current_max_value.call(e)),r.attr("aria-valuemin",l.get_current_min_value.call(e)).attr("aria-valuenow",l.get_current_max_value.call(e)).attr("aria-valuemax",e.data("range_max"))}else n.attr("aria-valuemin",e.data("range_min")).attr("aria-valuenow",l.get_current_min_value.call(e)).attr("aria-valuemax",e.data("range_max"));return e},getSliderWidthPx:function(){var e=this;return Math.round(e.width())},getGripPositionPx:function(e){return parseInt(e.css("left").replace("px",""),10)},getLeftGripPositionPx:function(){var e=this,t=e.data("settings"),n=e.find(t.left_grip_selector);return f.getGripPositionPx.call(e,n)},getRightGripPositionPx:function(){var e=this,t=e.data("settings");if(e.data("has_right_grip"))return f.getGripPositionPx.call(e,e.find(t.right_grip_selector));var n=f.getSliderWidthPx.call(e)-e.data("left_grip_width");return f.rangemap_0_to_n.call(e,e.data("cur_max"),n)},getLeftGripWidth:function(){var e=this,t=e.data("settings"),n=e.find(t.left_grip_selector);return Math.round(n.width())},getRightGripWidth:function(){var e=this,t=e.data("settings"),n=e.find(t.right_grip_selector);return Math.round(n.width())},binarySearch:function(e,t,n,r){for(var i,s,o=0,u=e.length-1;u>=o;){i=(o+u)/2|0,s=n(e,i);var a=r(t,e,i);if(a>0)o=i+1;else{if(!(0>a))return i;u=i-1}}return-1},haveLimits:function(){var e=this,t=e.data("lower-limit"),n=e.data("upper-limit"),r=!1;return"undefined"!=typeof t&&"undefined"!=typeof n&&(r=!0),r},refresh_grips_style:function(){var e=this,t=e.data("settings");if("undefined"!=typeof t.highlight){var n=e.data("highlightedRangeMin");if("undefined"!=typeof n){var r=e.find(t.left_grip_selector),i=e.find(t.right_grip_selector),s=e.data("highlightedRangeMax"),o=e.data("cur_min"),u=e.data("cur_max"),a=t.highlight.grip_class;n>o||o>s?r.removeClass(a):r.addClass(a),n>u||u>s?i.removeClass(a):i.addClass(a)}}},valueToPx:function(e){var t=this,n=t.data("value_to_pixel_mapping");if("undefined"!=typeof n)return n(e);var r=f.getSliderWidthPx.call(t)-t.data("left_grip_width");return f.rangemap_0_to_n.call(t,e,r)},set_position_from_val:function(e,t){var n=this,r=n.data("range_min"),i=n.data("range_max");r>e&&(e=r),e>i&&(e=i),n.data("has_right_grip")?(t>i&&(t=i),r>t&&(t=r)):t=n.data("cur_max");var s=f.valueToPx.call(n,e),o=f.valueToPx.call(n,t);return f.set_handles_at_px.call(n,s,o),n.data("cur_min",e),n.data("has_right_grip")&&n.data("cur_max",t),n},set_position_from_px:function(e,t){var n=this;f.set_handles_at_px.call(n,e,t);var r=f.getSliderValuesAtPositionPx.call(n,e,t),i=r[0],s=r[1];return n.data("cur_min",i),n.data("has_right_grip")&&n.data("cur_max",s),n},set_handles_at_px:function(e,t){var n=this,r=n.data("settings"),i=r.left_grip_selector,s=r.right_grip_selector,o=r.value_bar_selector,u=n.data("left_grip_width"),a=u/2;return n.data("has_right_grip")?(n.find(o).css("left",e+a+"px").css("width",t-e+a+"px"),n.find(i).css("left",e+"px")):(t>e?n.find(o).css("left",e+a+"px").css("width",t-e+a+"px"):n.find(o).css("left",t+a+"px").css("width",e-t+a+"px"),n.find(i).css("left",e+"px")),n.find(s).css("left",t+"px"),n},drag_start_func_touch:function(e,t,n,i,s){var o=this,u=e.originalEvent,a=u.touches[0],l=a.pageY,c=a.pageX,h=Math.abs(o.offset().top-l),p=o.offset().left,v=p-c,m=c-(p+o.width());h>t.touch_tolerance_value_bar_y||v>t.touch_tolerance_value_bar_x||m>t.touch_tolerance_value_bar_x||(u.preventDefault(),r=a.pageX,f.drag_start_func.call(o,a,t,n,i,s))},drag_start_func:function(r,s,o,u,a){var c=this;if(c.find(s.left_grip_selector+","+s.value_bar_selector+","+s.right_grip_selector).removeClass(s.animating_css_class),l.is_enabled.call(c)){var h=e(r.target),p=!1;if("object"==typeof s.highlight&&(p=h.is(s.highlight.panel_selector)),a!==!1||h.is(s.left_grip_selector)||h.is(s.right_grip_selector)||h.is(s.value_bar_selector)||p||h.is(c)){t=c;var d,v,m,g,y,w,E=f.getGripPositionPx.call(c,o),S=f.getSliderWidthPx.call(c)-c.data("left_grip_width"),x=o.offset().left,T=f.getRightGripPositionPx.call(c);v=r.pageX-c.data("left_grip_width")/2,m=Math.abs(x-v),y=v-x,c.data("has_right_grip")?(d=u.offset().left,g=Math.abs(d-v),w=v-d):(g=2*m,w=2*y),s.user_drag_start_callback.call(c,r),m===g?x>v?(E+=y,i=!0):(T+=w,i=!1):g>m?(E+=y,i=!0):(T+=w,i=!1),c.data("has_right_grip")?T>S&&(T=S):E>S&&(E=S),0>E&&(E=0),n=!0;var N=c.data("cur_min"),C=c.data("cur_max");f.set_position_from_px.call(c,E,T),f.refresh_grips_style.call(c),f.notify_changed_implicit.call(c,"drag_start",N,C),r.preventDefault()}}},drag_move_func_touch:function(e){if(n===!0){var t=e.originalEvent;t.preventDefault();var r=t.touches[0];f.drag_move_func(r)}},drag_move_func:function(e){if(n){var s=t,o=f.getSliderWidthPx.call(s)-s.data("left_grip_width"),u=f.getLeftGripPositionPx.call(s),a=f.getRightGripPositionPx.call(s),l=e.pageX,c=l-r,h=s.offset().left+s.data("left_grip_width"),p=h+o,v=0,m=0;h>l&&(v=1,m=0),l>p&&(m=1,v=0),s.data("has_right_grip")&&(i?o>=a&&u+c>a&&(i=!1,u=a):u>=0&&u>a+c&&(i=!0,a=u));var g=u,y=a;(c>0&&!v||0>c&&!m)&&(i?g+=c:y+=c),f.validateAndMoveGripsToPx.call(s,g,y),r=l,e.preventDefault()}},drag_end_func_touch:function(e){var t=e.originalEvent;t.preventDefault();var n=t.touches[0];f.drag_end_func(n)},drag_end_func:function(){var e=t;if("undefined"!=typeof e){n=!1,r=void 0,f.notify_mouse_up_implicit.call(e,i),t=void 0;var s=e.data("settings");e.find(s.left_grip_selector+","+s.value_bar_selector+","+s.right_grip_selector).addClass(s.animating_css_class)}},get_rounding_for_value:function(e){var t=this,n=t.data("rounding"),r=t.data("rounding_ranges");if("object"==typeof r){var i=f.binarySearch.call(t,r,e,function(e,t){return e[t].range},function(e,t,n){return e<t[n].range?n>0?e>=t[n-1].range?0:-1:0:1});if(n=1,i>-1)n=parseInt(r[i].value,10);else{var s=r.length-1;e>=r[s].range&&(n=r[s].value)}}return n},notify_mouse_up_implicit:function(e){var t=this,n=l.get_current_min_value.call(t),r=l.get_current_max_value.call(t),i=!1;(t.data("beforestart_min")!==n||t.data("beforestart_max")!==r)&&(i=!0,t.data("beforestart_min",n),t.data("beforestart_max",r));var s=t.data("settings");return s.user_mouseup_callback.call(t,l.get_current_min_value.call(t),l.get_current_max_value.call(t),e,i),t},notify_changed_implicit:function(e,t,n){var r=this,i=!1;("init"===e||"refresh"===e)&&(i=!0);var s=l.get_current_min_value.call(r),o=l.get_current_max_value.call(r);return i||(t=l.round_value_according_to_rounding.call(r,t),n=l.round_value_according_to_rounding.call(r,n)),(i||s!==t||o!==n)&&(f.notify_changed_explicit.call(r,e,t,n,s,o),i=1),i},notify_changed_explicit:function(e,t,n,r,i){var s=this,o=s.data("settings");return s.data("aria_enabled")&&f.updateAriaAttributes.call(s),o.value_changed_callback.call(s,e,r,i,t,n),s},validate_params:function(t){var n=this,r=n.data("range_min"),i=n.data("range_max"),s=n.data("cur_min"),o=n.data("lower-limit"),u=n.data("upper-limit"),a=f.haveLimits.call(n);"undefined"==typeof r&&e.error("the data-range_min attribute was not defined"),"undefined"==typeof i&&e.error("the data-range_max attribute was not defined"),"undefined"==typeof s&&e.error("the data-cur_min attribute must be defined"),r>i&&e.error("Invalid input parameter. must be min < max"),a&&o>u&&e.error("Invalid data-lower-limit or data-upper-limit"),0===n.find(t.left_grip_selector).length&&e.error("Cannot find element pointed by left_grip_selector: "+t.left_grip_selector),"undefined"!=typeof t.right_grip_selector&&0===n.find(t.right_grip_selector).length&&e.error("Cannot find element pointed by right_grip_selector: "+t.right_grip_selector),"undefined"!=typeof t.value_bar_selector&&0===n.find(t.value_bar_selector).length&&e.error("Cannot find element pointed by value_bar_selector"+t.value_bar_selector)},rangemap_0_to_n:function(e,t){var n=this,r=n.data("range_min"),i=n.data("range_max");return r>=e?0:e>=i?t:Math.floor((t*e-t*r)/(i-r))},inverse_rangemap_0_to_n:function(e,t){var n=this,r=n.data("range_min"),i=n.data("range_max");if(0>=e)return r;if(e>=t)return i;var s=(i-r)*e/t;return s+r}},l={teardown:function(){var t=this;return t.removeData(),e(document).unbind("mousemove.nstSlider").unbind("mouseup.nstSlider"),t.parent().unbind("mousedown.nstSlider").unbind("touchstart.nstSlider").unbind("touchmove.nstSlider").unbind("touchend.nstSlider"),t.unbind("keydown.nstSlider").unbind("keyup.nstSlider"),t},init:function(t){var n=e.extend({animating_css_class:"nst-animating",touch_tolerance_value_bar_y:30,touch_tolerance_value_bar_x:15,left_grip_selector:".nst-slider-grip-left",right_grip_selector:void 0,highlight:void 0,rounding:void 0,value_bar_selector:void 0,value_changed_callback:function(){},user_mouseup_callback:function(){},user_drag_start_callback:function(){}},t),r=e(document);return r.unbind("mouseup.nstSlider"),r.unbind("mousemove.nstSlider"),r.bind("mousemove.nstSlider",f.drag_move_func),r.bind("mouseup.nstSlider",f.drag_end_func),this.each(function(){var t=e(this),r=t.parent();t.data("enabled",!0);var c=t.data("range_min"),p=t.data("range_max"),d=t.data("cur_min"),v=t.data("cur_max");"undefined"==typeof v&&(v=d),""===c&&(c=0),""===p&&(p=0),""===d&&(d=0),""===v&&(v=0),t.data("range_min",c),t.data("range_max",p),t.data("cur_min",d),t.data("cur_max",v),f.validate_params.call(t,n),t.data("settings",n),"undefined"!=typeof n.rounding?l.set_rounding.call(t,n.rounding):"undefined"!=typeof t.data("rounding")?l.set_rounding.call(t,t.data("rounding")):l.set_rounding.call(t,1);var m=t.find(n.left_grip_selector)[0],y=e(m),b=e(t.find(n.right_grip_selector)[0]);"undefined"==typeof y.attr("tabindex")&&y.attr("tabindex",0);var w=!1;t.find(n.right_grip_selector).length>0&&(w=!0,"undefined"==typeof b.attr("tabindex")&&b.attr("tabindex",0)),t.data("has_right_grip",w),t.data("aria_enabled")===!0&&(y.attr("role","slider").attr("aria-disabled","false"),w&&b.attr("role","slider").attr("aria-disabled","false")),t.bind("keyup.nstSlider",function(e){if(t.data("enabled")){switch(e.which){case 37:case 38:case 39:case 40:if(s===u){var n,r,c,p=f.getSliderWidthPx.call(t);if(0>o-a){for(r=a;p>=r;r++)if(n=l.round_value_according_to_rounding.call(t,f.getSliderValuesAtPositionPx.call(t,r,r)[1]),n!==u){c=r;break}}else for(r=a;r>=0;r--)if(n=l.round_value_according_to_rounding.call(t,f.getSliderValuesAtPositionPx.call(t,r,r)[1]),n!==u){c=r;break}i?f.validateAndMoveGripsToPx.call(t,c,f.getRightGripPositionPx.call(t)):f.validateAndMoveGripsToPx.call(t,f.getLeftGripPositionPx.call(t),c),f.notify_mouse_up_implicit.call(t,i)}}s=void 0,o=void 0,u=void 0,a=void 0}}),t.bind("keydown.nstSlider",function(e){if(t.data("enabled")){var n=function(e,n){var r=f.getLeftGripPositionPx.call(t),c=f.getRightGripPositionPx.call(t);switch("undefined"==typeof s&&(o=i?r:c,s=i?l.get_current_min_value.call(t):l.get_current_max_value.call(t)),n.which){case 37:case 40:i?r--:c--,n.preventDefault();break;case 38:case 39:i?r++:c++,n.preventDefault()}a=i?r:c,f.validateAndMoveGripsToPx.call(t,r,c),u=i?l.get_current_min_value.call(t):l.get_current_max_value.call(t)};w&&t.find(":focus").is(b)?(i=!1,n.call(t,b,e)):(i=!0,n.call(t,y,e))}});var E=f.getLeftGripWidth.call(t),S=w?f.getRightGripWidth.call(t):E;t.data("left_grip_width",E),t.data("right_grip_width",S),t.data("value_bar_selector",n.value_bar_selector),c===p||d===v?l.set_range.call(t,c,p):f.set_position_from_val.call(t,t.data("cur_min"),t.data("cur_max")),f.notify_changed_implicit.call(t,"init"),t.data("beforestart_min",l.get_current_min_value.call(t)),t.data("beforestart_max",l.get_current_max_value.call(t)),t.bind("mousedown.nstSlider",function(e){f.drag_start_func.call(t,e,n,y,b,!1)}),r.bind("touchstart.nstSlider",function(e){f.drag_start_func_touch.call(t,e,n,y,b,!0)}),r.bind("touchend.nstSlider",function(e){f.drag_end_func_touch.call(t,e)}),r.bind("touchmove.nstSlider",function(e){f.drag_move_func_touch.call(t,e)});var x=t.data("histogram");"undefined"!=typeof x&&l.set_step_histogram.call(t,x)})},get_range_min:function(){var e=this;return e.data("range_min")},get_range_max:function(){var e=this;return e.data("range_max")},get_current_min_value:function(){var t,n=e(this),r=l.get_range_min.call(n),i=l.get_range_max.call(n),s=n.data("cur_min");if(t=r>=s?r:l.round_value_according_to_rounding.call(n,s),f.haveLimits.call(n)){if(r>=t)return n.data("lower-limit");if(t>=i)return n.data("upper-limit")}else{if(r>=t)return r;if(t>=i)return i}return t},get_current_max_value:function(){var t,n=e(this),r=l.get_range_min.call(n),i=l.get_range_max.call(n),s=n.data("cur_max");if(t=s>=i?i:l.round_value_according_to_rounding.call(n,s),f.haveLimits.call(n)){if(t>=i)return n.data("upper-limit");if(r>=t)return n.data("lower-limit")}else{if(t>=i)return i;if(r>=t)return r}return t},is_handle_to_left_extreme:function(){var e=this;return f.haveLimits.call(e)?e.data("lower-limit")===l.get_current_min_value.call(e):l.get_range_min.call(e)===l.get_current_min_value.call(e)},is_handle_to_right_extreme:function(){var e=this;return f.haveLimits.call(e)?e.data("upper-limit")===l.get_current_max_value.call(e):l.get_range_max.call(e)===l.get_current_max_value.call(e)},refresh:function(){var e=this,t=e.data("last_step_histogram");"undefined"!=typeof t&&l.set_step_histogram.call(e,t),f.set_position_from_val.call(e,l.get_current_min_value.call(e),l.get_current_max_value.call(e));var n=e.data("highlightedRangeMin");if("number"==typeof n){var r=e.data("highlightedRangeMax");l.highlight_range.call(e,n,r)}return f.notify_changed_implicit.call(e,"refresh"),e},disable:function(){var e=this,t=e.data("settings");return e.data("enabled",!1).find(t.left_grip_selector).attr("aria-disabled","true").end().find(t.right_grip_selector).attr("aria-disabled","true"),e},enable:function(){var e=this,t=e.data("settings");return e.data("enabled",!0).find(t.left_grip_selector).attr("aria-disabled","false").end().find(t.right_grip_selector).attr("aria-disabled","false"),e},is_enabled:function(){var e=this;return e.data("enabled")},set_position:function(e,t){var n=this,r=n.data("cur_min"),i=n.data("cur_max");e>t?f.set_position_from_val.call(n,t,e):f.set_position_from_val.call(n,e,t),f.refresh_grips_style.call(n),f.notify_changed_implicit.call(n,"set_position",r,i),n.data("beforestart_min",e),n.data("beforestart_max",t)},set_step_histogram:function(t){var n=this;n.data("last_step_histogram",t),"undefined"==typeof t&&(e.error("got an undefined histogram in set_step_histogram"),f.unset_step_histogram.call(n));var r=f.getSliderWidthPx.call(n)-n.data("left_grip_width"),i=t.length;if(!(0>=r)){var s,o=0;for(s=0;i>s;s++)o+=t[s];if(0===o)return l.unset_step_histogram.call(n),n;var u=parseFloat(o)/r;for(s=0;i>s;s++)t[s]=t[s]/u;var a=[t[0]];for(s=1;i>s;s++){var c=a[s-1]+t[s];a.push(c)}a.push(r);for(var h=[n.data("range_min")],p=0,d=h[0],v=0;r>=p;){var m=parseInt(a.shift(),10),g=f.inverse_rangemap_0_to_n.call(n,v+1,i+1);v++;var y=m-p,b=g-d;for(s=p;m>s;s++){var w=d+b*(s-p+1)/y;h.push(w),p++,d=w}if(p===r)break}h[h.length-1]=n.data("range_max");var E=function(e){return h[parseInt(e,10)]},S=function(t){var r=f.binarySearch.call(n,h,t,function(e,t){return e[t]},function(t,n,r){return t===n[r]?0:t<n[r]&&0===r?0:n[r-1]<=t&&t<n[r]?0:t>n[r]?1:t<=n[r-1]?-1:void e.error("cannot compare s: "+t+" with a["+r+"]. a is: "+n.join(","))});return r};return n.data("pixel_to_value_mapping",E),n.data("value_to_pixel_mapping",S),n}},unset_step_histogram:function(){var e=this;return e.removeData("pixel_to_value_mapping"),e.removeData("value_to_pixel_mapping"),e.removeData("last_step_histogram"),e},set_range:function(e,t){var n=this,r=l.get_current_min_value.call(n),i=l.get_current_max_value.call(n);return n.data("range_min",e),n.data("range_max",t),f.set_position_from_val.call(n,r,i),f.notify_changed_implicit.call(n,"set_range",r,i),n},highlight_range:function(t,n){var r=this,i=r.data("settings");"undefined"==typeof i.highlight&&e.error('you cannot call highlight_range if you haven\' specified the "highlight" parameter in construction!'),t||(t=0),n||(n=0);var s=f.valueToPx.call(r,t),o=f.valueToPx.call(r,n),u=o-s+r.data("left_grip_width"),a=r.find(i.highlight.panel_selector);return a.css("left",s+"px"),a.css("width",u+"px"),r.data("highlightedRangeMin",t),r.data("highlightedRangeMax",n),f.refresh_grips_style.call(r),r},set_rounding:function(t){var n=this;"string"==typeof t&&t.indexOf("{")>-1&&(t=e.parseJSON(t)),n.data("rounding",t);var r=[];if("object"==typeof t){var i;for(i in t)if(t.hasOwnProperty(i)){var s=t[i];r.push({range:s,value:i})}r.sort(function(e,t){return e.range-t.range}),n.data("rounding_ranges",r)}else n.removeData("rounding_ranges");return n},get_rounding:function(){var e=this;return e.data("rounding")},round_value_according_to_rounding:function(t){var n=this,r=f.get_rounding_for_value.call(n,t);if(r>0){var i=t/r,s=parseInt(i,10),o=i-s;o>.5&&s++;var u=s*r;return u}return e.error("rounding must be > 0, got "+r+" instead"),t}},c="nstSlider";e.fn[c]=function(t){if(l[t]){if(this.data("initialized")===!0)return l[t].apply(this,Array.prototype.slice.call(arguments,1));throw new Error("method "+t+" called on an uninitialized instance of "+c)}return"object"!=typeof t&&t?void e.error("Cannot call method "+t):(this.data("initialized",!0),l.init.apply(this,arguments))}}(jQuery)